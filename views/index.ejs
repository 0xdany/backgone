<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BackGone</title>
    <link href="/styles/output.css" rel="stylesheet" />
    <script src="/node_modules/htmx.org/dist/htmx.min.js"></script>
    <style>
      .dropzone {
        border: 2px dashed #ccc;
        border-radius: 10px;
        padding: 20px;
        text-align: center;
        cursor: pointer;
      }
    </style>
  </head>

  <body class="bg-gray-100 text-center">
    <h1 class="text-4xl font-bold text-blue-600 mt-10">Remove everything but you!</h1>

    <div id="dropzone" class="dropzone mt-10" hx-post="/upload" hx-encoding="multipart/form-data" hx-trigger="drop" hx-target="#result">
      Drag and drop an image here or click to upload
      <input type="file" name="image" style="display: none" />
    </div>

    <div class="w-full flex justify-center items-center max-h-72 bg-red-600">
      <div id="result" class="mt-10 "></div>
    </div>

    <script>
      document.getElementById("dropzone").addEventListener("click", function () {
        this.querySelector('input[type="file"]').click();
      });

      document.getElementById("dropzone").addEventListener("change", function (event) {
        const fileInput = event.target;
        const formData = new FormData();
        formData.append("image", fileInput.files[0]);

        document.getElementById("result").innerHTML = "<p>Processing...</p>";

        fetch("/upload", {
          method: "POST",
          body: formData,
        })
          .then((response) => response.json())
          .then((data) => {
            document.getElementById("result").innerHTML = `
              <img src="${data.imageUrl}" alt="Processed Image" class="max-h-80">
              <br>
              <a href="${data.imageUrl}" download="processed.png" class="mt-2 inline-block bg-blue-500 text-white px-4 py-2 rounded">Download</a>
            `;
          })
          .catch((error) => {
            console.error("Error:", error);
            document.getElementById("result").innerHTML = "<p>Error processing image. Please try again.</p>";
          });
      });

      document.getElementById("dropzone").addEventListener("drop", function (event) {
        event.preventDefault();
        const files = event.dataTransfer.files;
        if (files.length > 0) {
          const formData = new FormData();
          formData.append("image", files[0]);

          document.getElementById("result").innerHTML = "<p>Processing...</p>";

          fetch("/upload", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.json())
            .then((data) => {
              document.getElementById("result").innerHTML = `
                <img src="${data.imageUrl}" alt="Processed Image" class="mt-4">
                <br>
                <a href="${data.imageUrl}" download="processed.png" class="mt-2 inline-block bg-blue-500 text-white px-4 py-2 rounded">Download</a>
              `;
            })
            .catch((error) => {
              console.error("Error:", error);
              document.getElementById("result").innerHTML = "<p>Error processing image. Please try again.</p>";
            });
        }
      });
    </script>
  </body>
</html>
